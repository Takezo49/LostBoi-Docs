# Recon and Enum

### Recon and Enumeration

#### OSINT OR Passive Recon

ðŸ’¡ Not that useful for OSCP as we'll be dealing with internal machines

```bash
whois DOMAIN
whois DOMAIN -h WHOIS_SERVER
```

**Google dorking:**

* site:
* filetype:
* intitle:
* GHDB - Google hacking database

**OS and Service Information using** [searchdns.netcraft.com](http://searchdns.netcraft.com)

**Github dorking:**

* filename:
* user:
* A tool called Gitleaks for automated enumeration

**Shodan dorks:**

* hostname:
* port:
* Then gather info by going through the options

**Scanning Security headers and SSL/TLS using** [https://securityheaders.com/](https://securityheaders.com/) Port

#### Port Scanning

```bash
#use -Pn option if you're getting nothing in scan
nmap -sC -sV TARGET_IP -v  #Basic scan
nmap -T4 -A -p- TARGET_IP -v  #complete scan
sudo nmap -sV -p 443 --script "vuln" 192.168.50.124  #running vuln category scripts

#NSE
updatedb
locate .nse | grep SEARCH_TERM
sudo nmap --script="name" TARGET_IP  #here we can specify other options like specific ports

# PowerShell
Test-NetConnection -Port PORT_NUMBER TARGET_IP
1..1024 | % {echo ((New-Object Net.Sockets.TcpClient).Connect("IP", $_)) "TCP port $_ is open"}
```

#### FTP Enumeration

```bash
ftp TARGET_IP
#login if you have relevant creds or based on nmap scan find out whether this has anonymous access

# Commands within FTP
put LOCAL_FILE  #uploading file
get REMOTE_FILE  #downloading file

#NSE
locate .nse | grep ftp
nmap -p21 --script=SCRIPT_NAME TARGET_IP

#bruteforce
hydra -L users.txt -P passwords.txt TARGET_IP ftp  #'-L' for usernames list, '-l' for username
#check for vulnerabilities associated with the version identified.
```

#### SSH Enumeration

```bash
#Login
ssh username@IP  #enter password in the prompt

#id_rsa or id_ecdsa file
chmod 600 id_rsa/id_ecdsa
ssh username@IP -i id_rsa/id_ecdsa  #if it still asks for password, crack them using John

#cracking id_rsa or id_ecdsa
ssh2john id_ecdsa > hash
# OR
ssh2john id_rsa > hash
john --wordlist=/home/sathvik/Wordlists/rockyou.txt hash

#bruteforce
hydra -l username -P passwords.txt TARGET_IP ssh  #'-L' for usernames list, '-l' for username
#check for vulnerabilities associated with the version identified.
```

#### SMB Enumeration

```bash
sudo nbtscan -r 192.168.50.0/24  #IP or range can be provided

#NSE scripts can be used
locate .nse | grep smb
nmap -p445 --script="name" $IP

#In windows we can view like this
net view \\\\TARGET_IP /all

#crackmapexec
crackmapexec smb TARGET_IP
crackmapexec smb 192.168.1.100 -u username -p password
crackmapexec smb 192.168.1.100 -u username -p password --shares  #lists available shares
crackmapexec smb 192.168.1.100 -u username -p password --users  #lists users
crackmapexec smb 192.168.1.100 -u username -p password --all  #all information
crackmapexec smb 192.168.1.100 -u username -p password -p 445 --shares  #specific port
crackmapexec smb 192.168.1.100 -u username -p password -d mydomain --shares  #specific domain
#In place of username and password, we can include usernames.txt and passwords.txt for pass spraying
```

**Smbclient**

```bash
smbclient -L //IP  #or try with 4 /'s
smbclient //server/share
smbclient //server/share -U USERNAME
smbclient //server/share -U domain/username

#SMBmap
smbmap -H <target_ip>
smbmap -H <target_ip> -u USERNAME -p PASSWORD
smbmap -H <target_ip> -u USERNAME -p PASSWORD -d DOMAIN
smbmap -H <target_ip> -u USERNAME -p PASSWORD -r <share_name>

#Within SMB session
put LOCAL_FILE  #to upload file
get REMOTE_FILE  #to download file
```

**Downloading shares made easy** - if the folder consists of several files, they all be downloading by this.

```bash
mask ""
recurse ON
prompt OFF
mget *
```

#### HTTP/S Enumeration

* View source-code and identify any hidden content. If some image looks suspicious download and try to find hidden data in it.
* Identify the version or CMS and check for active exploits. This can be done using Nmap and Wappalyzer.
* check `/robots.txt` folder
* Look for the hostname and add the relevant one to `/etc/hosts` file.
* Directory and file discovery - Obtain any hidden files which may contain juicy information

```bash
dirbuster
gobuster dir -u <http://example.com> -w /path/to/wordlist.txt
python3 [dirsearch.py](<http://dirsearch.py>) -u <http://example.com> -w /path/to/wordlist.txt
```

* Vulnerability Scanning using nikto:

```bash
nikto -h TARGET_IP
```

* SSL certificate inspection, this may reveal information like subdomains, usernamesâ€¦etc
* Default credentials, Identify the CMS or service and check for default credentials and test them out.
* Bruteforce

```bash
hydra -L users.txt -P password.txt TARGET_IP http-{post/get}-form "/path:name=USER&pass=PASS:invalid"
```

* Use https-post-form mode for https, post or get can be obtained from Burpsuite. Also check the failed-login message and replace "invalid" with that message.

**#Bruteforce can also be done by Burpsuite but it's slow, prefer Hydra!**

* if `cgi-bin` is present then do further fuzzing and obtain files like `.sh` or `.pl`
* Check if other services like FTP/SMB or any others which has upload privileges are getting reflected on web.
* API - Fuzz further and it can reveal some sensitive information

```bash
#identifying endpoints using gobuster
gobuster dir -u <http://192.168.50.16:5002> -w /usr/share/wordlists/dirb/big.txt -p pattern

#obtaining info using curl
curl -i <http://192.168.50.16:5002/users/v1><br>â€¢/api/endpoint
```

If there is any Input field check for Remote Code execution or SQL Injection

* Check the URL, whether we can leverage Local or Remote File Inclusion.
* Also check if there's any file upload utility(also obtain the location it's getting reflected)

#### Wordpress

```bash
# basic usage
wpscan --url "target" --verbose

# enumerate vulnerable plugins, users, vulnerable themes, timthumbs
wpscan --url "target" --enumerate vp,u,vt,tt --follow-redirection --verbose --log target.log
```

* Add Wpscan API to get the details of vulnerabilities.

#### Drupal

```bash
droopescan scan drupal -u <http://site>
```

#### Joomla

```bash
droopescan scan joomla --url <http://site>
sudo python3 [joomla-brute.py](<http://joomla-brute.py>) -u <http://site/> -w passwords.txt -usr username  #<https://github.com/ajnik/joomla-bruteforce>
```

#### DNS Enumeration

```bash
host [www.megacorpone.com](<http://www.megacorpone.com>)
host -t mx [megacorpone.com](<http://megacorpone.com>)
host -t txt [megacorpone.com](<http://megacorpone.com>)

for ip in $(seq 200 254); do host 51.222.169.$ip; done | grep -v "not found"  #bash bruteforce

dnsrecon -d [megacorpone.com](<http://megacorpone.com>) -t std  #standard recon
dnsrecon -d [megacorpone.com](<http://megacorpone.com>) -D ~/list.txt -t brt  #bruteforce, hence we provided list

dnsenum [megacorpone.com](<http://megacorpone.com>)

nslookup [mail.megacorptwo.com](<http://mail.megacorptwo.com>)
nslookup -type=TXT [info.megacorptwo.com](<http://info.megacorptwo.com>) 192.168.50.151  #we're querying with a specific IP
```

#### SMTP Enumeration

```bash
nc -nv TARGET_IP 25  #Version Detection
smtp-user-enum -M VRFY -U username.txt -t TARGET_IP  # -M means mode, it can be RCPT, VRFY, EXPN

#Sending email with valid credentials, the below is an example for Phishing mail attack
sudo swaks -t [user1@test.com](<mailto:user1@test.com>) -t [user2@test.com](<mailto:user2@test.com>) --from [user3@test.com](<mailto:user3@test.com>) --server <mailserver> --auth --username <username> --password <password> --h-Subject "Subject" --body "Body"
```

#### LDAP Enumeration

```bash
ldapsearch -x -H ldap://TARGET_IP -D '' -w '' -b "DC=<1_SUBDOMAIN>,DC=<TLD>"
ldapsearch -x -H ldap://TARGET_IP -D '<username>' -w '<password>' -b "DC=<1_SUBDOMAIN>,DC=<TLD>"
ldapsearch -x -H ldap://TARGET_IP -D '<username>' -w '<password>' -b "CN=Users,DC=<1_SUBDOMAIN>,DC=<TLD>"
ldapsearch -x -H ldap://TARGET_IP -D '<username>' -w '<password>' -b"CN=Computers,DC=<1_SUBDOMAIN>,DC=<TLD>"
ldapsearch -x -H ldap://TARGET_IP -D '<username>' -w '<password>' -b "CN=Domain Admins,DC=<1_SUBDOMAIN>,DC=<TLD>"
ldapsearch -x -H ldap://TARGET_IP -D '<username>' -w '<password>' -b"CN=Domain Users,DC=<1_SUBDOMAIN>,DC=<TLD>"
ldapsearch -x -H ldap://TARGET_IP -D '<username>' -w '<password>' -b "CN=Enterprise Admins,DC=<1_SUBDOMAIN>,DC=<TLD>"
ldapsearch -x -H ldap://TARGET_IP -D '<username>' -w '<password>' -b"CN=Administrators,DC=<1_SUBDOMAIN>,DC=<TLD>"
ldapsearch -x -H ldap://TARGET_IP -D '<username>' -w '<password>' -b "CN=Remote Desktop Users,DC=<1_SUBDOMAIN>,DC=<TLD>"

#[windapsearch.py](<http://windapsearch.py>)
#for computers
python3 [windapsearch.py](<http://windapsearch.py>) --dc-ip DC_IP -u USERNAME -p PASSWORD --computers

#for groups
python3 [windapsearch.py](<http://windapsearch.py>) --dc-ip DC_IP -u USERNAME -p PASSWORD --groups

#for users
python3 [windapsearch.py](<http://windapsearch.py>) --dc-ip DC_IP -u USERNAME -p PASSWORD --da

#for privileged users
python3 [windapsearch.py](<http://windapsearch.py>) --dc-ip DC_IP -u USERNAME -p PASSWORD --privileged-users
```

#### NFS Enumeration

```bash
nmap -sV --script=nfs-showmount TARGET_IP
showmount -e TARGET_IP
```

#### SNMP Enumeration

```bash
snmpcheck -t TARGET_IP -c public
snmpwalk -c public -v1 -t 10 TARGET_IP
snmpenum -t TARGET_IP
```

#### RPC Enumeration

```bash
rpcclient -U=user $DCIP
rpcclient -U="" $DCIP  #Anonymous login

##Commands within RPCclient
srvinfo
enumdomusers  #users
enumpriv  #like "whoami /priv"
queryuser <RID>  #detailed user info
getuserdompwinfo <RID>  #password policy, get user-RID from previous command
lookupnames <username>  #SID of specified user
createdomuser <username>  #Creating a user
deletedomuser <username>
enumdomains
enumdomgroups
querygroup <GROUP_RID>  #get rid from previous command
querydispinfo  #description of all users
netshareenum  #Share enumeration, this only comes up if the current user we're logged in has permission
netshareenumall
lsaenumsid  #SID of all users
```
